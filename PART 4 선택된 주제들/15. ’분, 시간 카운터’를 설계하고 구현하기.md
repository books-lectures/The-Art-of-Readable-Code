# 15. 'ë¶„/ì‹œê°„ ì¹´ìš´í„°'ë¥¼ ì„¤ê³„í•˜ê³  êµ¬í˜„í•˜ê¸°

## í´ë˜ìŠ¤ ì¸í„°í˜ì´ìŠ¤ ì •ì˜í•˜ê¸°

```cpp
class MinuteHourCounter {
  public:
    void Count(int num_bytes);
    int MinuteCount();
    int HourCount();
}
```

### ì´ë¦„ì„ ê°œì„ í•˜ê¸°

`MinuteCount()`, `HourCount()`ë¼ëŠ” ì´ë¦„ì€ êµ¬ì²´ì ì´ë¼ ê½¤ ê´œì°®ì€ ì´ë¦„ì´ë‹¤.

í•˜ì§€ë§Œ Countë¼ëŠ” ë‹¨ì–´ëŠ” ì˜¤í•´ë¥¼ ìœ ë°œí•˜ëŠ” ì›ì¸ì´ ë  ìˆ˜ ìˆë‹¤.

- Increment()
    
    â‡’ ê°’ì´ ê³„ì† ì¦ê°€í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— X
    
- Observe()
    
    â‡’  ê´œì°®ì§€ë§Œ ë‹¤ì†Œ ì˜¤í˜¸í•˜ë‹¤
    
- Record()
    
    â‡’ ëª…ì‚¬ì¸ì§€ ë™ì‚¬ì¸ì§€ ëª¨ë¥´ê¸° ë•Œë¬¸ì— X
    
- Add()
    
    â‡’ â€œìˆ˜ì¹˜ì ìœ¼ë¡œ ë”í•˜ë¼â€ í˜¹ì€ â€œë°ì´í„° ë¦¬ìŠ¤íŠ¸ì— ë”í•˜ë¼" ë‘ ê°€ì§€ ì˜ë¯¸ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ì„œ O
    
    â‡’ `void Add(int count)`ë¡œ ê³ ì¹˜ëŠ” ê²ƒì´ O (byte, deltaë³´ë‹¤ ì‹¬í”Œí•´ì„œ good)
    

### ì£¼ì„ì„ ê°œì„ í•˜ê¸°

```cpp
class MinuteHourCounter {
  public:
    // ì¹´ìš´íŠ¸ë¥¼ ë”í•œë‹¤.
	    void Add(int count);
    // 1ë¶„ ë™ì•ˆì˜ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
    int MinuteCount();
    // 1ì‹œê°„ ë™ì•ˆì˜ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
    int HourCount();
}
```

ğŸ‘Â  ì£¼ì„ì´ í•¨ìˆ˜ëª…ê³¼ ì™„ì „íˆ ì¤‘ë³µëœë‹¤.

```cpp
  // ì¹´ìš´íŠ¸ë¥¼ ë”í•œë‹¤.
	void Add(int count);
```

ğŸ‘

ì£¼ì„ì„ ì•„ì˜ˆ ì§€ìš°ê±°ë‚˜ ì´ë˜ì™€ ê°™ì´ ì£¼ì„ì„ ì“°ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```cpp
  // ìƒˆë¡œìš´ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ ë”í•œë‹¤ (count >= 0)
  // ë‹¤ìŒ 1ë¶„ ë™ì•ˆ MinuteCount()ëŠ” +countì— ì˜í•´ì„œ ê°’ì´ ì»¤ì§„ë‹¤
  // ë‹¤ìŒ 1ì‹œê°„ ë™ì•ˆ HourCount()ëŠ” +countì— ì˜í•´ì„œ ê°’ì´ ì»¤ì§„ë‹¤.
	void Add(int count);
```

ğŸ‘Â 

```cpp
 // 1ë¶„ ë™ì•ˆì˜ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
 int MinuteCount();

 // 1ì‹œê°„ ë™ì•ˆì˜ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
 int HourCount();
```

ğŸ‘Â ì„¤ëª…ì„ ë” ëª…í™•í•˜ê³  ìì„¸í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤

```cpp
 // ì§€ë‚œ 60ì´ˆ ë™ì•ˆ ëˆ„ì ëœ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
 int MinuteCount();

 // ì§€ë‚œ 3600ì´ˆ ë™ì•ˆ ëˆ„ì ëœ ì¹´ìš´íŠ¸ë¥¼ ë°˜í™˜í•œë‹¤.
 int HourCount();
```

## ì‹œë„1: ìˆœì§„í•œ í•´ê²°ì±…

```cpp
class MinuteHourCounter {
 struct Event {
  Event(int count, time_t time): count(count), time(time) {}
  int count,
  time_t time,
  };
  list<Event> events;

public:
  void Add(int, count) {
    events.push_back(Event(count, time()));
   }

 ...
};
```

![KakaoTalk_Photo_2022-07-02-12-48-27 002](https://user-images.githubusercontent.com/64571546/177028008-b74b97fc-c61d-44da-9c23-a642620c3932.jpeg)


## ì´ ì½”ë“œëŠ” ì´í•´í•˜ê¸° ì‰¬ìš´ê°€?

ê°€ë…ì„±ê³¼ ê´€ë ¨í•œ ë‘ ê°€ì§€ ë¬¸ì œê°€ ìˆë‹¤.

- for ë£¨í”„ ì½”ë“œê°€ ë³µì¡í•˜ë‹¤
- MinuteCount(), HourCount()ì˜ ë‚´ìš©ì´ ê±°ì˜ ë˜‘ê°™ë‹¤.

### ë” ì½ê¸° ì‰¬ìš´ ë²„ì „

![KakaoTalk_Photo_2022-07-02-12-48-27 001](https://user-images.githubusercontent.com/64571546/177028041-e9316a04-61ca-473b-80f8-9d7018366aad.jpeg)


- CountSince() í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì¤‘ë³µëœ ì½”ë“œë¥¼ ì œê±°
- ë‘ ë²ˆì§¸ iì—ì„œ ritë¡œ ë³€ê²½
Reverse Iterator(ì—­ë°©í–¥ ë°˜ë³µì)

## ì‹œë„2: ì»¨ë² ì´ì–´ ë²¨íŠ¸ ì„¤ê³„

ìœ„ ì‹œë„1ì€ ì„±ëŠ¥ê´€ë ¨ ì‹¬ê°í•œ ë¬¸ì œê°€ ë‘ê°€ì§€ ìˆë‹¤. ì´ë¥¼  í•´ê²°í•˜ê¸°ìœ„í•´ ë‘ê°€ì§€ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤

1. ì´ë²¤íŠ¸ê°€ ëŠ˜ì–´ë‚˜ê¸°ë§Œ í•œë‹¤
â‡’ í•„ìš”ì—†ëŠ” ë°ì´í„°ëŠ” ì‚­ì œí•œë‹¤
2. MinuteCount()ì™€ HourCount()ê°€ ë„ˆë¬´ ëŠë¦¬ë‹¤
ìœ„ ë‘ ë©”ì†Œë“œëŠ” O(n)ì‹œê°„ ë³µì¡ë„ë¥¼ ê°–ëŠ”ë°, ë§¤ë²ˆ ìƒˆë¡œê³„ì‚°í•˜ê¸° ë•Œë¬¸ì— ë¹„íš¨ìœ¨ì ì´ë‹¤. 
â‡’ í´ë˜ìŠ¤ ì•ˆì— ëˆ„ì ê°’ì¸ minute_countì™€ hour_countë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤

### í•´ê²°ë°©ì•ˆ1

ìœ„ì˜ ë¬¸ì œë“¤ì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ í•„ìš”í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë“¤ì„ list<Event> ëˆ„ì ê°’ ì—ì„œ ì œê±°í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ MinuteCount()ì™€ HourCount()ë¥¼ ìœ„í•œ ê°’ì„ ë”°ë¡œ ë§Œë“¤ì–´ ë¶ˆí•„ìš”í•œ Eventë“¤ì„ ì œê±°í•˜ë©°, ê´€ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ, ê°™ì€ê°’ì´ 2ë²ˆì €ì¥ë˜ê¸° ë•Œë¬¸ì— ì•„ë˜ê·¸ë¦¼ê³¼ ê°™ì´ MinuteCount()ê°€ HourCount()ì— í¬í•¨ë˜ë„ë¡í•˜ëŠ”ê²Œ ë” íš¨ìœ¨ì ì´ë‹¤

![IMG_2262 (1)](https://user-images.githubusercontent.com/64571546/177028079-de36b49a-7939-4c0e-978e-e6c9c6f813b5.jpg)


### í•´ê²°ë°©ì•ˆ2

1ë¶„ë™ì•ˆì˜ ëˆ„ì ê°’ì´ 1ì‹œê°„ë™ì•ˆì˜ ëˆ„ì ê°’ì— í¬í•¨ë˜ë„ë¡ ì„¤ê³„í•œ ë°©ì‹

![IMG_2263 (1)](https://user-images.githubusercontent.com/64571546/177028103-d6ee0e07-c5d9-4d78-84ea-3fb64b8b186b.jpg)


```java
class MinuteHourCounter {

	// ì§€ë‚œ 1ë¶„ë™ì•ˆ ë°œìƒí•œ ì´ë²¤íŠ¸ë“¤
	list<Event> minute_events;

	// ì§€ë‚œ 1ì‹œê°„ë™ì•ˆ ë°œìƒí•œ ì´ë²¤íŠ¸ë“¤(minute_events ë¯¸í¬í•¨)
	list<Event> hour_events;
	
	// ëˆ„ì ê°’
	list minute_count;
	list hour_count;
}

// ì»¨ë² ì´ì–´ ë²¨íŠ¸ ì„¤ê³„ì˜ í•µì‹¬ì€ ì‹œê°„ì´ ì§€ë‚˜ë©´ minute_eventsì˜ ì•„ì´í…œë“¤ì„ hour_eventsë¡œ ì˜®ê¸°ëŠ”ê²ƒì´ë‹¤
// ì´ ì§€ì €ë¶„í•œ ì¼ë“¤ì€ ShiftOldEvents()ë¼ëŠ” í—¬í¼í•¨ìˆ˜ì— ë‹´ì•„ë‘”ë‹¤

void Add(int count) {
	const time_t now_secs = time();
	ShiftOldEvents(now_secs);
	
	// ë¶„ì„ ìœ„í•œ ë¦¬ìŠ¤íŠ¸ì— ë„£ëŠ”ë‹¤
	minute_event.push_back(Event(count, now_secs));

	minute_count += count;
	hour_count += count;
}

void MinuteCount() {
	ShiftOldEvents(time());
	return minute_count;
}

void HourCount() {
	ShiftOldEvents(time());
	return hour_count;
}

```

### ì§€ì €ë¶„í•œì¼ì„ í•´ê²°í•˜ëŠ” ShiftOldEventsí•¨ìˆ˜

- minute_countì—ì„œ 1ë¶„ì´ ì§€ë‚œ ê°’ë“¤ì„ hour_countë¡œ ì´ë™ì‹œí‚¨ë‹¤
- 1ì‹œê°„ì´ ì§€ë‚œ Eventë“¤ì„ hour_eventì—ì„œ ì œê±°í•œë‹¤
- ëˆ„ì ê°’ì¸ minute_countì™€ hour_countì˜ ê°’ì„ ê°ì†Œì‹œí‚¨ë‹¤

```java
void ShiftOldEvents(time_t now_sect) {
	const int minute_ago = now_secs - 60;
	const int hour_ago = now_secs - 3600;
	
	// 1. minute_countì—ì„œ 1ë¶„ì´ ì§€ë‚œ ê°’ë“¤ì„ hour_countë¡œ ì´ë™ì‹œí‚¨ë‹¤
	while(!minute_event.empty() && minute_events.front().time <= minute_ago) {
		hour_event.push_back(minute_event.front());
		minute_count -= minute_event.front().count;
		minute_events.pop_front();
	}
	
	// 2. 1ì‹œê°„ì´ ì§€ë‚œ Eventë“¤ì„ listì—ì„œ ì œê±°í•œë‹¤
	// 3. ëˆ„ì ê°’ì¸ minute_countì™€ hour_countì˜ ê°’ì„ ê°ì†Œì‹œí‚¨ë‹¤
	while(!hour_event.empty() && hour_events.front().time <= hour_ago) {
		hour_count -= hour_events.front().count;
		hour_events.pop_front();
	
	}
} 
```

## ì‹œë„3: ì‹œê°„-ë°”êµ¬ë‹ˆ ì„¤ê³„

ìœ„ ì‹œë„2ëŠ” ì‘ì€ ë²„ê·¸ê°€ ìˆë‹¤. ì‹œê°„ì„ ì •í•˜ëŠ” time_tê°€ ì‹¤ì œë¡œ ë°˜í™˜í•˜ëŠ”ê°’ì€ ì •ìˆ˜ë¥¼ ìœ„í•œ ë°˜ì˜¬ë¦¼ ê³¼ì •ì„ ê±°ì¹˜ê¸° ë•Œë¬¸ì— ë²”ìœ„ì˜ ì˜¤ì°¨ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤

ìœ„ì˜ ë¬¸ì œë•Œë¬¸ì— í‰ê· ì ìœ¼ë¡œ MinuteCount()ëŠ” 59.5ì´ˆ, HourCountëŠ” 3599.5ì´ˆì˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤

ë¬´ì‹œí•´ë„ ì¢‹ì€ ì˜¤ì°¨ì´ì§€ë§Œ, ì‹œê°„-ë°”êµ¬ë‹ˆ ì„¤ê³„ë¥¼ í†µí•´ í›¨ì”¬ ë” ë¹ ë¥´ê³  ê³µê°„ì„ ì ê²Œ ì‚¬ìš©í•˜ê²Œ ê°œì„ í•  ìˆ˜ ìˆë‹¤.

êµ¬í˜„ì„ í•˜ê²Œë˜ë©´ í¬ê²Œ 2ê°€ì§€ ê¸°ëŠ¥ìœ¼ë¡œ ë‚˜ë‰œë‹¤.

### 1. ë°”êµ¬ë‹ˆì— ë‹´ê¸°ê²Œë˜ëŠ” count ê³„ì‚°

```java
// ë°”êµ¬ë‹ˆì— ë‹´ê¸°ê²Œë˜ëŠ” count ê³„ì‚°
// ì§€ë‚˜ê°„ Nê°œì˜ ë°”êµ¬ë‹ˆì— ëŒ€í•œ ì¹´ìš´íŠ¸ë¥¼ ë³´ê´€í•˜ëŠ” í´ë˜ìŠ¤

class TrailingBucketCounter {
	public:
		// TrailingBucketCounter(30, 60)ì€ ì§€ë‚œ 30ë¶„ì— ëŒ€í•œ ë°”êµ¬ë‹ˆë¥¼ ì²˜ë¦¬
		TrailingBucketCounter(int num_buckets, int secs_per_bucket);
		
		// now ì‹œê°„ì€ ì™¸ë¶€ì—ì„œ ì¸ìˆ˜ë¡œ ë°›ìŒìœ¼ë¡œì¨ 'ì‹œê³„ê°€ ì—†ëŠ”'í´ë˜ìŠ¤ë¡œ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰½ê³ , ë²„ê·¸ë„ ì ë‹¤
		// ê·¸ë¦¬ê³  time()ì— ëŒ€í•œ í˜¸ì¶œì€ ëª¨ë‘ MinuteHourCounterë‚´ë¶€ë¡œ ì œí•œí•  ìˆ˜ ìˆë‹¤
		void Add(int count, time_t now);
		
		int TrailingCount(time_t now);
}
```

ìœ„ì—ì„œ ë§Œë“  ëˆ„ì ê¸° í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ MinuteHourCounterë¥¼ êµ¬í˜„í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤

```java
class MinuteHourCounter {
	TrailingBucketCounter minute_counts;
	TrailingBucketCounter hour_counts;
	
	public:
		MinuteHourCounter() :
		minute_counts(60, 1)   // ë°”êµ¬ë‹ˆí¬ê¸°ê°€ 1ì´ˆ, ë°”êµ¬ë‹ˆê°œìˆ˜ëŠ” 60ê°œ
		hour_counts(60, 60) {} // ë°”êµ¬ë‹ˆí¬ê¸°ê°€ 60ì´ˆ, ë°”êµ¬ë‹ˆê°œìˆ˜ëŠ” 60ê°œ

	void Add(int count) {
		time_t now = time();
		minute_counts.Add(count, now);
		hour_counts.Add(count, now);
	}

	int MinuteCount() {
		time_t now = time();
		return minute_counts.TrailingCount(now);
	}

	int HourCount() {
		time_t now = time();
		return hour_counts.TrailingCount(now);
	}
}
```

### 2. ì˜¤ë˜ëœ ì •ë³´ëŠ” ë–¨ì–´ì ¸ ë‚˜ê°€ë©°, ìœ íš¨í•œ êµ¬ê°„ì— ëŒ€í•œ ì´í•© ê³„ì‚°

```java
// ì˜¤ë˜ëœ ë°ì´í„°ê°€ íì˜ í•œìª½ëì—ì„œ 'ë–¨ì–´ì ¸ë‚˜ê°€ëŠ”' ìµœëŒ€ë¡œ ë§ì€ ìˆ˜ì˜ ìŠ¬ë¡¯ì„ ê°€ì§€ê³ ìˆëŠ” í
class ConveyorQueue {
	ConveyorQueue(int max_items);
	
	// íì˜ ë’¤ì— ê°’ì„ ì¦ê°€ì‹œí‚¨ë‹¤ë‹¤
	void AddToBack(int count);
	
	// íë¥¼ num_shiftedë§Œí¼ ì•ìœ¼ë¡œ ì´ë™ì‹œí‚¨ë‹¤
	// ë¹„ê²Œë˜ëŠ” í•­ëª©ì€ 0ìœ¼ë¡œ ì´ˆê¸°í™”ëœë‹¤
	// íëŠ” FIFOì´ê¸°ë•Œë¬¸ì— ì˜¤ë˜ëœ í•­ëª©ë¶€í„° ì œê±°ë˜ê³ , í•­ëª©ì˜ ìˆ˜ëŠ” max_itemsë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ë‹¤
	void Shift(int num_shifted);
	
	// í˜„ì¬ íì— ìˆëŠ” ëª¨ë“  í•­ëª©ì˜ ì´í•©ì„ ë°˜í™˜í•œë‹¤
	int TotalSum();
}
```

êµ¬í˜„ëœ ConveyorQueueí´ë˜ìŠ¤ë¥¼ TrailingBucketCounterì—ì„œ ì‚¬ìš©í•œë‹¤. 

TrailingBucketCounterì—ì„œ í˜„ì¬ì‹œê°„ì— ë§ì¶° ConveyorQueueë¥¼ shiftí•˜ê³ , ìƒˆë¡œìš´ ë°”êµ¬ë‹ˆë¥¼ ì¶”ê°€í•œë‹¤

```java
class TrailingBucketCounter {
	ConveyorQueue buckets;
	const int secs_per_bucket;
	time_t last_updated_time; // Update()ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ í˜¸ì¶œëœ ì‹œê°„
	
	void Update(time_t now) {
		int current_bucket = now / secs_per_bucket;
		int last_update_bucket = last_update_time / secs_per_bucket;
		
		buckets.Shift(current_bucket - last_update_bucket);
		last_update_time = now
	}

	public:
		TrailingBucketCounter(int num_buckets, int secs_per_bucket):
			buckets(num_buckets),
			secs_per_bucket(secs_per_bucket) {
		}
		
		void Add(int count, time_t now) {
			Update(now);
			buckets.AddToBack(count);
		}
		
		int TrailingCount(time_t now) {
			Update(now);
			return buckets.TotalSum();
		}
}
```

# 3ê°€ì§€ í•´ê²°ì±… ë¹„êµ

![IMG_2264 (1)](https://user-images.githubusercontent.com/64571546/177028131-4d47be07-e953-4eee-8faa-18833542d6c3.jpg)


ë§ˆì§€ë§‰ ë°©ë²•ì´ ì½”ë“œëŸ‰ì´ ì œì¼ ë§ì§€ë§Œ, ì„±ëŠ¥ì€ í›¨ì”¬ ë›°ì–´ë‚˜ê³ , ì„¤ê³„ë„ ìœ ì—°í•˜ë‹¤.

ì—¬ëŸ¬ê°œì˜ í´ë˜ìŠ¤ë¥¼ ì„ í˜•ì ìœ¼ë¡œ ê´€ê³„ì§€ì–´ ì´ìš©í–ˆê¸°ì— ì‚¬ìš©ìëŠ” ìµœìƒë‹¨ì˜ í´ë˜ìŠ¤ë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ì´í•´í•  ìˆ˜ ìˆë‹¤ .

ì½ê¸°ì‰¬ìš´ 100ì¤„ì˜ ì½”ë“œëŠ” ì½ê¸° ì–´ë ¤ìš´ 50ì¤„ì˜ ì½”ë“œì— ë¹„í•´ì„œ í›¨ì”¬ ë‚«ë‹¤.