# 10. 상관없는 하위문제 추출하기

큰 흐름과 관계가 적은 하위문제를 발견해서 추출하라

- 주어진 함수나 코드블록의 목적을 생각해라
- 코드의 모든 줄에 질문을 던져라. 이 코드는 목적을 위해서 존재 하는가? 혹은 목적을 위해서 필요하긴 하지만 목적 자체와 직접적으로 상관없는 하위 문제를 해결하는가 ?
- 하위 문제를 해결하는 코드 분량이 많으면 이를 추출해서 별도의 함수로 만든다.

이 과정은 코드를 개선시킨다. 전체 목적에 직접 상관없는 하위문제를 다루는 코드를 적극적으로 찾으려고 노력하는 것.

### findClosestLocation()

주어진 점과 가장 가까운 장소를 찾는 함수가 있다고 가정하자.

해당 함수에는 두 점을 라디안 값으로 변경하고, 코사인 특별법칙 공식을 사용한다.

따라서 이 내용은 spherical_distance() 라는 별도 함수로 추출한다.

장점1 : 코드를 읽는 사람은 밀도 높은 기하 공식에 방해 받지 않고, 상위수준의 목적에 집중할 수 있으니 코드 가독성이 높아졌다.

장점2 : spherical_distance() 는 독립적인 테스트도 더 용이하다.

### 순수한 유틸리티 코드

사용하는 라이브러리에 xyz() 라는 함수가 존재하지 않으나 필요성을 느꼈다면 스스로 작성해보라.

### 일반적인 목적의 코드

다음 함수는 Ajax를 이용해서 데이터를 서버에 제출하고, 서버가 반환한 데이터 딕셔너리를 화면에 나타낸다.

```tsx
ajax_post({
	url: 'http://example.com/submit',
	data: data,
	on_success: function (res_data) {
		var str = "{\n";
		for( var key in res_data) {
			str += "" + key + "=" + res_data[key] + "\n";
		}
	alert(str + "}");
//계속해서 res_data를 처리한다.
	}
})
```

이 코드의 상위 목적은 Ajax 호출을 하고 응답을 처리하는 것이다. 하지만 코드의 대부분이 이러한 목적과 직접 상관없는 하위문제, 즉 딕셔너리에 담긴 내용을 예쁘게 출력하는 일을 한다. 이러한 코드를 추출해서 별도의 함수로 묶어야 한다.

```tsx
var format_pretty = function(obj) {
	var str = "{\n"
	for(var key in obj) {
		str += " " + key + " = " + obj[key] + "\n"
	}
return str + "}"
}
```

따로 추출한 경우의 장점 1 : 코드를 간단하게 만들 수 있다. 

장점 2: 다른 곳에서도 간편하게 사용할 수 있다.

장점 3: 필요한 경우 format_pretty 함수를 훨씬 손쉽게 개선할 수 있다. 작은 함수를 다룰 때는 기능을 더하고, 가독성을 개선하고 , 코너 케이스를 다루는 일이 상대적으로 쉽게 느껴진다.

### 일반적인 목적을 가진 코드를 많이 만들어라

코드베이스는 종종 이와 같은 코드를 담아두는(ex. util) 디렉터리를 따로 두고 있으므로 코드를 쉽게 공유할 수 있다. 이러한 코드베이스는 프로젝트에서 완전히 분리되어있기 때문에 소스코드 자체의 양이 줄어들게 된다.

- 하향식 프로그래밍 : 가장 상위 수준의 모듈과 함수를 먼저 설계하고 가장 하위 수준의 기능은 높은 수준을 지원할 때마다 구현하는 방식
- 상향식 프로그래밍 : 모든 하위 문제를 예상하고 구현한 다음 이러한 조각을 이용해서 가장 상위수준의 컴포넌트를 만들어 나간다.

### 특정한 프로젝트를 위한 기능

이상적인 상황이라면 추출한 하위 문제는 사용하는 프로젝트를 전혀 몰라야 한다. 하지만 하위문제를 분리하는 것만으로도 큰 도움이 된다.

### 기존 인터페이스를 단순화하기

이상적이지 않은 인터페이스를 그냥 받아들일 이유는 없다. 이런 인터페이스가 있으면 이를 둘러싸는 함수를 작성하여 지저분한 내부를 감출 수 있다.

### 지나치게 추출하기

너무 자잘한 함수를 사용하면 오히려 가독성을 해친다. 코드에 새로운 함수를 더하는 일에는 분명히 가독성 비용이 든다. 작은 함수들이 다른 프로젝트에서도 사용된다면 추출하는것이 그리 나쁘지 않다. 하지만 그런 순간이 오기 전까지는 추출할 필요가 없다.
