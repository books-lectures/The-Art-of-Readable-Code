# 5. 주석에 담아야 하는 대상

```
💡 주석의 목적은 코드를 읽는 사람이 코드를 작성한 사람만큼 코드를 잘 이해하게 돕는 데 있다.
```

# 주석에 쓰지 말아야 할 것

```cpp
class Account {
  public:
    // 생성자
    Account();

    // profit에 새로운 값을 설정
    void SetProfit(double profit);

    // 이 어카운트의 profit을 반환
    double GetProfit();
};
```

이러한 주석은 새로운 정보를 제공하거나 코드를 읽는 사람이 코드를 더 잘 이해하도록 도와주지 않으므로 아무런 가치가 없다.

```
💡 코드에서 `빠르게` 유추할 수 있는 내용은 주석으로 달지 말라.
```

위의 말에서 `빠르게`라는 형용사는 매우 중요한 차이를 만든다. 다음과 같은 파이썬 코드에 담긴 주석을 살펴보자.

```python
# 두 번째 '*' 뒤에 오는 내용을 모두 제거한다.
name = '*'.join(line.split('*')[:2])
```

기술적으로는 이 주석에는 ‘새로운 정보’가 없다. 하지만 대부분의 프로그래머는 코드가 아닌 주석을 읽고 코드가 수행하는 일을 훨씬 더 빠르게 이해한다.

## 설명 자체를 위한 설명을 달지 말라

```cpp
// 주어진 이름과 깊이를 이용해서 서브트리[h1]에 있는 노드를 찾는다.
Node* FindNodeInSubtree(Node* subtree, string name, int depth);
```

이는 ‘무가치한 주석’의 범주에 속한다. 함수의 선언과 주석 내용이 실질적으로 일치하기 때문이다.

이 함수를 위한 주석을 달고 싶으면, 더 중요한 세부 사항을 적는 것이 낫다.

```cpp
// 주어진 'name'으로 노드를 찾거나 아니면 NULL을 반환한다.
// 만약 depth <= 0이면 'subtree'만 검색된다.
// 만약 depth == N이면 N 레벨과 그 아래만 검색된다.
Node* FindNodeInSubtree(Node* subtree, string name, int depth);
```

## 나쁜 이름에 주석을 달지 마라 - 대신 이름을 고쳐라

```
💡 좋은 코드 > 나쁜 코드 + 좋은주석
```

```cpp
// 해당 키를 위한 핸들을 놓아준다. 이 함수는 실제 레지스트리를 수정하지는 않는다.
void DeleteRegistry(RegistryKey* key);
```

`DeleteRegistry()` 라는 함수명은 뭔가 위험한 일을 하는 것처럼 (레지스트리를 지운다고?!) 들린다. 주석은 이러한 의심을 완하시키려고 작성되었다.

대신 이름 자체가 정확한 설명을 하는 편이 더 낫다.

```cpp
void ReleaseResgistryHandle(RegistryKey* key);
```

# 주석에 써야할 것

## 생각을 기록하라

좋은 주석은 단순히 ‘자신의 생각을 기록하는 것’만으로도 탄생할 수 있다. 즉, 코딩할 때 생각했던 중요한 순간을 기록하면 된다.

```cpp
// 이 주먹구구식 논리는 몇 가지 단어를 생략할 수 있다. 상관없다. 100% 해결은 쉽지 않다.
```

이 주석이 없으면 코드를 읽는 사람은 뭔가 버그가 있다고 생각하고 실패를 찾기 위한 테스트 케이스를 짜거나, 버그를 수정하는 데 시간을 허비할지도 모른다.

```cpp
// 이 클래스는 점점 엉망이 되어가고 있다. 어쩌면 'ResourceNode' 하위클래스를
// 만들어서 정리해야 할지도 모르겠다.
```

이 주석은 코드가 엉망이라는 사실을 밝히고 다음 사람에게 어떻게 수정해야 하는지 알려준다. 만약 이 주석이 없으면 많은 사람이 이 코드에 겁을 먹어 건드리지 않으려고 할 것이다.

## 코드에 있는 결함을 설명하라

개선이 필요할 때

```cpp
// TODO: 더 빠른 알고리즘을 사용하라.
```

혹은 코드가 불완전할 때

```cpp
// TODO(benkim): JPEG말고 다른 이미지 포맷도 처리할 수 있어야 한다.
```

개선 아이디어를 설명하는 게 좋다.

이런 상황에 프로그래머 사이에서 널리 사용되는 표시가 몇 개 있다.

| 표시 |  의미 |
| --- | --- |
| TODO | 앞으로 해야할 일 |
| FIXME | 오동작을 일으킨다고 알려진 코드 (버그) |
| HACK | 아름답지 않은 해결책 |
| XXX | 위험! 여기 큰 문제가 있다. |


팀에 따라 표시나, 언제 사용하는지 등은 다를 수 있다. 예를 들어 팀 내 약속에 따라 `TODO`(대문자)는 반드시 해결해야 하는 중요 문제에만 사용할 수도 있다. 그렇다면 중요하지 않은 문제는 `todo`(소문자) 같은 표시를 사용할 수 있다.

## 상수에 대한 설명

```python
NUM_THREADS = 8
```

별도의 설명이 필요하지 않을 것 처럼 보이지만, 이러한 상수값을 선택한 사람은 분명히 뭔가 더 많은 사실을 알고 있을 것이다.

```python
NUM_THREADS = 8 # 이 상수값이 2 * num_processors보다 크거나 같으면 된다.
```

이제 상수값을 어떻게 변경해야 하는지 작성자 외에도 알 수 있다.

또 다른 예시다.

```cpp
// 합리적인 한계를 설정하라 - 그렇게 많이 읽을 수 있는 사람은 어차피 없다.
const int MAX_RSS_SUBSCRIPTIONS = 1000;
```

## 코드를 읽는 사람의 입장이 되어라

### 나올 것 같은 질문 예측하기

```cpp
struct Recorder {
  vector<float> data;
  ...
  void Clear() {
    vector<float>().swap(data); *// 뭐? 그냥 data.clear()를 호출하지 않는 이유가 뭐지?*
  } 
}
```

C++ 프로그래머가 이 코드를 읽는다면 대부분이 그냥 `data.clear()`를 호출하지 않는 이유를 궁금해 할 것이다. 하지만 이것은  `vector`가 메모리 할당자에게 자신의 메모리를 실제로 반납하게 하는 유일한 방법이다. 이는 잘 알려지지 않은 C++ 언어 특유의 세부 사항이다. 이 코드에는 다음과 같은 주석이 있어야 했다.

```cpp
// 벡터가 메모리를 반납하도록 강제한다("STL swap trick"을 보라).
vector<float>().swap(data);
```

### 사람들이 쉽게 빠질 것 같은 함정을 경고하라

함수나 클래스 문서를 작성할 때 스스로에게 “내가 작성한 이 코드를 다른 사람이 읽으면 깜짝 놀랄 만한 부분이 있나? 오용될 수도 있나?” 등의 좋은 질문을 던질 필요가 있다.

예를 들어 제대로 작성되지 않은 HTML에 닫기 태그(closting tag)를 삽입하는 함수를 작성했다고 해보자.

```python
def FixBrokenHTML(html): ...
```

이 함수는 HTML이 겹겹으로 중첩되었는데 짝이 맞지 않는 태그가 있으면 엄청난 시간을 허비한다는 함정이 도사리고 있다.

이 코드를 사용하는 사람이 단점을 스스로 깨닫게 하기보다는 주석으로 미리 알려주는 게 좋다.

```python
# 실행시간이 O(number_tags * average_tag_depth)이므로 엉망으로 중첩된 입력을
# 사용할 때는 주의해야 한다.
def FixBrokenHTML(html): ...
```

### ‘큰 그림’에 대한 주석

```
💡 상세하고 공식적인 문서를 작성해야 한다는 생각에 압도당하지 말라. 잘 선택된 몇몇 문장이 아무것도 없는 것보다는 훨씬 낫다.
```

팀에 새롭게 합류한 사람들은 ‘큰 그림’ 을 이해하는 데 어려움을 겪는다. 하지만 시스템을 설계하는 사람은 시스템의 구석구석이 모두 자연스럽게 느껴지므로 종종 주석을 달아 내용을 설명해야 한다는 사실을 망각한다.

다음과 같은 상황을 상정해보자. **팀에 새로운 사람이 합류했고, 여러분은 그분이 팀의 코드베이스에 익숙해지게 도와 주어야 한다**

여러분은 그분에게 코드베이스를 개략적으로 보여주면서 특정 클래스나 파일을 가리키고 이렇게 말할지도 모른다.

- “비즈니스 로직과 데이터베이스를 연결해주는 코드입니다. 애플리에키션 코드에서는 직접 이용하면 안됩니다.”
- “이 클래스는 복잡하게 보이지만, 사실 스마트 캐시에 불과합니다. 시스템의 다른 부분은 전혀 모르는 코드에요“

앞서 설명한 말은 바로 상위수준(high-level) 주석에 포함되어야 하는 내용이다.

다음은 파일수준(file-level) 주석에 있어야 하는 설명의 예다.

```cpp
// 파일시스템에 편리한 인터페이스를 제공하는 헬퍼 함수들을 담고 있다.
// 파일의 퍼미션과 다른 자세한 세부 사항을 처리한다.
```

### 요약 주석

심지어 함수 내부에서 ‘큰 그림’을 설명하는 방식도 좋다. 다음은 더 아래에 있는 하위 수준(low-level) 코드의 내용을 간결하게 요약하는 주석의 예다.

```python
# 고객이 자신을 위해서 구입한 항목을 모두 찾는다.
for customer_id in all_customers:
  for sale in all_sales[customer_id].sales:
    if sale.recipient == customer_id:
      ...
```

이러한 요약 주석은 몇몇 커다란 ‘덩어리’로 구성된 긴 함수에 특히 유용하다.

```python
def GenerateUserReport():
  # 이 사용자를 위한 lock을 얻는다.
  ...
  # 데이터베이스에서 사용자의 정보를 읽는다.
  ...
  # 정보를 파일에 작성한다.
  ...
  # 사용자를 위한 lock을 되돌려 넣는다.
  ...
```

다만 이러한 덩어리들이 쉽게 분리 될 수 있다면 **별도의 함수로 분리**하는 방법을 고려할 수 있다. 앞에서 말했듯이 좋은 코드는 나쁜 코드와 좋은 주석이 결합된 것보다 좋다!!!!

## 마지막 고찰 - 글 쓰는 두려움을 떨쳐내라

```
💡 주석을 부지런히 작성하지 않으면, 나중에 한꺼번에 많은 분량의 주석을 달아야할 수도 있다.
```

머릿속에 떠오르는 생각을, 심지어 다듬어지지 않은 생각이라고 해도 일단 주석에 쓰기 시작하라.

예를 들어 어느 함수를 작성하는데 “이런 제길, 이 리스트 안에 중복된 항목이 있으면 이건 복잡해지잖아”라고 생각 했다면 그냥 그 말을 주석으로 작성하라.

```cpp
// 이런 제길, 이 리스트 안에 중복된 항목이 있으면 이건 복잡해지잖아.
```

이것은 그리 나쁜 주석도 아니다. 아무 것도 없는 것보다 당연히 더 낫다. 다만 사용된 단어가 좀 모호하기 때문에 구체적인 표현으로 바꿔보자.

- ‘이런 제길’은 ‘주의: 주의를 기울여야 할 내용’을 의미한다.
- ‘이건’이라는 표현은 ‘입력을 다루는 코드’를 의미한다.
- ‘복잡해지잖아’라는 표현은 ‘구현하기 어려워진다’를 의미한다.

그러면 이렇게 새 주석으로 다시 태어난다.

```cpp
// 주의: 이 코드는 리스트 안에 있는 중복된 항목을 다루지 않는다.
// 그렇게 하는 것이 어렵기 때문이다.
```

주석을 작성하는 과정을 다음과 같이 아주 간단한 단계로 정리해봤다.

1. 마음에 떠오르는 생각을 무조건 적어본다.
2. 주석을 읽고 무엇이 개선되어야 하는지 (그런 부분이 있다면) 확인한다.
3. 개선한다.

주석을 더 자주 달수록 1번 단계에서 떠오르는 생각의 질이 향상되어 궁극적으로는 수정할 필요가 없게 된다.
